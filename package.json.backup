cd "E:\React-App\transport-app-123"

# 1. First, let's see what's wrong with package.json
Write-Host "Checking package.json..." -ForegroundColor Yellow

# Check first few characters (hex)
Write-Host "First 10 bytes (hex):" -ForegroundColor Cyan
$bytes = [System.IO.File]::ReadAllBytes("$PWD\package.json")
$firstBytes = $bytes[0..9] -join ' '
Write-Host $firstBytes

# Check if it starts with BOM (EF BB BF = 239 187 191)
if ($bytes[0] -eq 239 -and $bytes[1] -eq 187 -and $bytes[2] -eq 191) {
    Write-Host "❌ package.json has UTF-8 BOM" -ForegroundColor Red
}

# 2. Create a clean package.json
Write-Host "Creating clean package.json..." -ForegroundColor Green

# Backup old one first
if (Test-Path package.json) {
    Copy-Item package.json package.json.backup -Force
    Write-Host "✅ Backed up old package.json" -ForegroundColor Green
}

# Create clean package.json WITHOUT BOM
$cleanPackageJson = '{
  "name": "transport-app-123",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "deploy": "npm run build && firebase deploy --only hosting"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.0.0",
    "vite": "^5.0.0"
  }
}'

# Save without BOM
[System.IO.File]::WriteAllText("$PWD\package.json", $cleanPackageJson, [System.Text.UTF8Encoding]::new($false))

# 3. Verify it's valid JSON
try {
    $test = Get-Content package.json | ConvertFrom-Json
    Write-Host "✅ package.json is valid JSON" -ForegroundColor Green
} catch {
    Write-Host "❌ Still invalid JSON" -ForegroundColor Red
}

# 4. Now try to build
Write-Host "Building..." -ForegroundColor Yellow
npm run build

# 5. Deploy if successful
if (Test-Path dist) {
    Write-Host "✅ Build successful! Deploying..." -ForegroundColor Green
    firebase deploy --only hosting
}